import React, { useEffect, useRef, useState } from 'react';
import '../styles/logo.css';

function setSafariStrokeTiming(refs) {
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  if (isSafari) {
    refs.forEach(ref => {
      if (ref.current) {
        ref.current.style.animationTimingFunction = 'ease-in-out';
      }
    });
  }
}

const Logo = () => {
  const [isRefAvailable, setIsRefAvailable] = useState(false);
  const [wiggleActive, setWiggleActive] = useState(false);
  // Refs for "Mouad" letters
  const ref_M = useRef(null);
  const ref_O = useRef(null);
  const ref_U = useRef(null);
  const ref_A = useRef(null);
  const ref_D = useRef(null);
  const ref_Separator = useRef(null);

  // Refs for tag elements
  const ref_TagElement1 = useRef(null);
  const ref_TagElement2 = useRef(null);
  const ref_TagElement3 = useRef(null);

  useEffect(() => {
    const refsToCalculate = [
      ref_M,
      ref_O,
      ref_U,
      ref_A,
      ref_D,
      ref_TagElement1,
      ref_TagElement2,
      ref_TagElement3,
      ref_Separator,
    ];
    let allRefsAvailable = true;

    refsToCalculate.forEach(ref => {
      if (ref.current) {
        const length = ref.current.getTotalLength();
        ref.current.style.setProperty('--path-length', length.toString());
        ref.current.style.setProperty('--neg-path-length', (-length).toString());
      } else {
        allRefsAvailable = false;
      }
    });

    if (allRefsAvailable) {
      setIsRefAvailable(true);
      // ðŸ§­ Safari detection + override of the animation timing function
      setSafariStrokeTiming(refsToCalculate);
    }
  }, [isRefAvailable]);

  return (
      <div
          className="LogoInner"
          onAnimationEnd={e => {
              // only run when the eventâ€™s target
              //_is_ this element itself cus children end of animation can bubble and trigger this
              if (e.target !== e.currentTarget) return;
              setWiggleActive(true);
          }}
      >
          <div className={wiggleActive ? 'svgWiggler' : ''}>
        <svg xmlns="http://www.w3.org/2000/svg" width="1124" height="141" viewBox="0 0 1124 141" fill="none">

                  <g xmlns="http://www.w3.org/2000/svg" clipPath="url(#clip0_999_36)">
                      <path ref={ref_U}
                          id="U_path"
                          d="M952.879 92.7087C952.892 92.654 952.879 92.5955 952.879 92.5398C952.879 63.1704 952.879 62.3945 952.879 62.3945M952.879 92.7087V109.092M952.879 92.7087C948.986 109.228 934.907 109.833 927.339 109.092C913.1 107.699 909.958 98.4204 909.958 85.8112V62.3945" stroke="url(#paint0_linear_999_36)"
                          strokeWidth="9.36667"
                          strokeLinecap="round" />
                      <g clipPath="url(#clip1_999_36)">
                          <path
                              ref={ref_A}
                              id="A_path"
                              d="M1025.58 84.4241C1025.57 78.4124 1023.16 72.3775 1018.29 67.4037C1008.36 57.2643 992.991 58.0695 983.827 67.0401C974.664 76.0107 973.101 90.9175 983.464 101.501C993.827 112.085 1007.94 111.638 1017.93 101.865C1023.01 96.886 1025.59 90.6675 1025.58 84.4241ZM1025.58 84.4241V109.58" stroke="url(#paint1_linear_999_36)"
                              strokeWidth="9.36667" strokeLinecap="round" />
                      </g>
                      <path
                          ref={ref_D}
                          id="D_path"
                          d="M1095.83 84.3683C1095.82 78.3566 1093.41 72.3217 1088.54 67.3479C1078.61 57.2085 1063.24 58.0137 1054.08 66.9843C1044.91 75.9549 1043.35 90.8617 1053.71 101.446C1064.08 112.029 1078.19 111.582 1088.18 101.809C1093.26 96.8302 1095.84 90.6117 1095.83 84.3683ZM1095.83 84.3683L1095.81 30.7832" stroke="url(#paint2_linear_999_36)" strokeWidth="9.36667" strokeLinecap="round" />
                      <path
                          ref={ref_O}
                          id="O_path"
                          d="M851.133 67.0401C841.97 76.0107 840.407 90.9175 850.77 101.501C861.132 112.085 875.25 111.638 885.231 101.865C895.213 92.0918 895.523 77.5431 885.596 67.4037C875.668 57.2643 860.296 58.0695 851.133 67.0401Z" stroke="url(#paint3_linear_999_36)" strokeWidth="9.36667" strokeLinecap="round" />
                      <g clipPath="url(#clip2_999_36)">
                          <path
                              ref={ref_M}
                              id="M_path"
                              d="M750.148 115.321C741.042 92.5552 736.488 60.6834 750.148 47.0228C765.603 31.5684 777.468 67.057 777.467 77.0742C778.378 60.6825 785.117 30.6311 804.787 41.5589C824.457 52.4867 820.268 95.2877 815.715 115.322" stroke="url(#paint4_linear_999_36)" strokeWidth="11.7083" />
                      </g>
                      <path d="M104.594 114.159C99.5363 114.159 94.7906 113.223 90.357 111.349C85.9859 109.414 82.1456 106.76 78.836 103.388C75.5889 99.9532 73.0287 95.9568 71.1553 91.3983C69.3444 86.8399 68.439 81.9068 68.439 76.599C68.439 71.3537 69.3444 66.483 71.1553 61.987C73.0287 57.4285 75.5889 53.4633 78.836 50.0913C82.1456 46.6569 85.9859 43.9718 90.357 42.036C94.7281 40.1002 99.4739 39.1323 104.594 39.1323C109.403 39.1323 113.524 39.7568 116.958 41.0057C120.455 42.2545 123.952 44.3152 127.449 47.1877C127.949 47.5623 128.323 47.9682 128.573 48.4053C128.885 48.78 129.073 49.1859 129.135 49.623C129.26 49.9977 129.322 50.466 129.322 51.028C129.322 52.2144 128.885 53.2135 128.011 54.0253C127.199 54.7747 126.2 55.2118 125.014 55.3367C123.827 55.3991 122.672 54.9932 121.548 54.119C119.238 52.1208 116.833 50.5909 114.336 49.5293C111.9 48.4678 108.653 47.937 104.594 47.937C100.91 47.937 97.4444 48.6863 94.1973 50.185C90.9502 51.6837 88.0778 53.7443 85.58 56.367C83.1447 58.9897 81.2401 62.0494 79.8663 65.5463C78.4926 68.9808 77.8057 72.665 77.8057 76.599C77.8057 80.5954 78.4926 84.3421 79.8663 87.839C81.2401 91.2734 83.1447 94.302 85.58 96.9247C88.0778 99.5473 90.9502 101.608 94.1973 103.107C97.4444 104.543 100.91 105.261 104.594 105.261C107.779 105.261 110.776 104.73 113.586 103.669C116.459 102.545 119.206 101.015 121.829 99.079C122.953 98.2672 124.046 97.9238 125.107 98.0487C126.231 98.1111 127.168 98.5482 127.917 99.36C128.667 100.109 129.041 101.171 129.041 102.545C129.041 103.169 128.916 103.794 128.667 104.418C128.417 104.98 128.042 105.511 127.543 106.01C124.171 108.695 120.549 110.725 116.677 112.099C112.868 113.472 108.841 114.159 104.594 114.159ZM148.275 81.1887C148.275 77.442 149.181 74.1012 150.992 71.1663C152.865 68.169 155.363 65.7961 158.485 64.0477C161.607 62.2992 165.042 61.425 168.788 61.425C172.535 61.425 175.314 62.0494 177.125 63.2983C178.998 64.4848 179.716 65.921 179.279 67.607C179.092 68.4812 178.717 69.1681 178.155 69.6677C177.655 70.1048 177.062 70.3858 176.375 70.5107C175.688 70.6355 174.939 70.6043 174.127 70.417C170.131 69.6052 166.54 69.5428 163.356 70.2297C160.171 70.9165 157.642 72.1967 155.769 74.07C153.958 75.9433 153.052 78.3162 153.052 81.1887H148.275ZM148.369 113.223C146.87 113.223 145.715 112.848 144.903 112.099C144.091 111.287 143.686 110.1 143.686 108.539V66.6703C143.686 65.1717 144.091 64.0164 144.903 63.2047C145.715 62.3929 146.87 61.987 148.369 61.987C149.93 61.987 151.085 62.3929 151.835 63.2047C152.646 63.954 153.052 65.1092 153.052 66.6703V108.539C153.052 110.038 152.646 111.193 151.835 112.005C151.085 112.817 149.93 113.223 148.369 113.223ZM206.844 113.597C202.285 113.597 198.195 112.473 194.574 110.225C190.952 107.915 188.079 104.824 185.956 100.952C183.896 97.0183 182.865 92.5848 182.865 87.6517C182.865 82.7185 183.989 78.285 186.237 74.351C188.548 70.417 191.639 67.326 195.51 65.078C199.444 62.7675 203.847 61.6123 208.717 61.6123C213.588 61.6123 217.959 62.7675 221.831 65.078C225.702 67.326 228.762 70.417 231.01 74.351C233.32 78.285 234.476 82.7185 234.476 87.6517H230.823C230.823 92.5848 229.761 97.0183 227.638 100.952C225.577 104.824 222.736 107.915 219.114 110.225C215.492 112.473 211.402 113.597 206.844 113.597ZM208.717 105.167C211.902 105.167 214.743 104.418 217.241 102.919C219.739 101.358 221.706 99.2663 223.142 96.6437C224.578 93.9585 225.296 90.9612 225.296 87.6517C225.296 84.2797 224.578 81.2823 223.142 78.6597C221.706 75.9745 219.739 73.8827 217.241 72.384C214.743 70.8229 211.902 70.0423 208.717 70.0423C205.595 70.0423 202.754 70.8229 200.194 72.384C197.696 73.8827 195.698 75.9745 194.199 78.6597C192.763 81.2823 192.045 84.2797 192.045 87.6517C192.045 90.9612 192.763 93.9585 194.199 96.6437C195.698 99.2663 197.696 101.358 200.194 102.919C202.754 104.418 205.595 105.167 208.717 105.167ZM229.699 113.316C228.325 113.316 227.17 112.879 226.233 112.005C225.359 111.068 224.922 109.913 224.922 108.539V94.2083L226.701 84.2797L234.476 87.6517V108.539C234.476 109.913 234.007 111.068 233.071 112.005C232.196 112.879 231.072 113.316 229.699 113.316ZM254.221 113.223C253.035 113.223 251.973 112.786 251.036 111.911C250.1 111.037 249.631 109.882 249.631 108.446V62.268C249.631 57.772 250.506 53.8692 252.254 50.5597C254.065 47.2501 256.563 44.6899 259.747 42.879C262.932 41.0057 266.616 40.069 270.8 40.069C272.174 40.069 273.298 40.4749 274.172 41.2867C275.109 42.0984 275.577 43.1288 275.577 44.3777C275.577 45.5641 275.109 46.5944 274.172 47.4687C273.298 48.2804 272.174 48.6863 270.8 48.6863C268.49 48.6863 266.46 49.2171 264.712 50.2787C262.963 51.3402 261.589 52.8077 260.59 54.681C259.654 56.5543 259.185 58.7711 259.185 61.3313V108.446C259.185 109.882 258.748 111.037 257.874 111.911C257 112.786 255.782 113.223 254.221 113.223ZM245.604 71.9157C244.292 71.9157 243.231 71.541 242.419 70.7917C241.607 70.0423 241.201 69.1057 241.201 67.9817C241.201 66.7328 241.607 65.7337 242.419 64.9843C243.231 64.235 244.292 63.8603 245.604 63.8603H268.739C270.051 63.8603 271.112 64.235 271.924 64.9843C272.736 65.7337 273.142 66.7328 273.142 67.9817C273.142 69.1057 272.736 70.0423 271.924 70.7917C271.112 71.541 270.051 71.9157 268.739 71.9157H245.604ZM301.728 113.223C298.605 113.223 295.795 112.442 293.298 110.881C290.8 109.257 288.833 107.072 287.397 104.324C285.96 101.577 285.242 98.4858 285.242 95.0513V50.3723C285.242 48.9985 285.679 47.8745 286.554 47.0003C287.428 46.1261 288.552 45.689 289.926 45.689C291.299 45.689 292.423 46.1261 293.298 47.0003C294.172 47.8745 294.609 48.9985 294.609 50.3723V95.0513C294.609 97.5491 295.296 99.641 296.67 101.327C298.043 103.013 299.729 103.856 301.728 103.856H304.912C306.036 103.856 306.973 104.293 307.722 105.167C308.534 106.042 308.94 107.166 308.94 108.539C308.94 109.913 308.409 111.037 307.348 111.911C306.348 112.786 305.037 113.223 303.414 113.223H301.728ZM280.934 71.9157C279.622 71.9157 278.561 71.541 277.749 70.7917C276.937 70.0423 276.531 69.1057 276.531 67.9817C276.531 66.7328 276.937 65.7337 277.749 64.9843C278.561 64.235 279.622 63.8603 280.934 63.8603H302.571C303.882 63.8603 304.943 64.235 305.755 64.9843C306.567 65.7337 306.973 66.7328 306.973 67.9817C306.973 69.1057 306.567 70.0423 305.755 70.7917C304.943 71.541 303.882 71.9157 302.571 71.9157H280.934ZM344.755 113.597C339.572 113.597 334.951 112.505 330.892 110.319C326.896 108.071 323.742 105.011 321.432 101.14C319.184 97.2057 318.06 92.7097 318.06 87.6517C318.06 82.5312 319.121 78.0352 321.245 74.1637C323.43 70.2297 326.427 67.1699 330.237 64.9843C334.046 62.7363 338.417 61.6123 343.35 61.6123C348.221 61.6123 352.404 62.7051 355.901 64.8907C359.398 67.0138 362.052 69.9799 363.863 73.789C365.736 77.5357 366.673 81.8755 366.673 86.8087C366.673 87.9951 366.267 88.9942 365.455 89.806C364.643 90.5553 363.613 90.93 362.364 90.93H324.617V83.4367H362.083L358.243 86.0593C358.18 82.9371 357.556 80.1583 356.37 77.723C355.183 75.2252 353.497 73.2582 351.312 71.822C349.126 70.3858 346.472 69.6677 343.35 69.6677C339.791 69.6677 336.731 70.4482 334.171 72.0093C331.673 73.5704 329.768 75.7248 328.457 78.4723C327.146 81.1574 326.49 84.2172 326.49 87.6517C326.49 91.0861 327.27 94.1459 328.832 96.831C330.393 99.5161 332.547 101.639 335.295 103.2C338.042 104.761 341.196 105.542 344.755 105.542C346.691 105.542 348.658 105.199 350.656 104.512C352.717 103.762 354.371 102.919 355.62 101.983C356.557 101.296 357.556 100.952 358.618 100.952C359.742 100.89 360.709 101.202 361.521 101.889C362.583 102.826 363.145 103.856 363.207 104.98C363.27 106.104 362.77 107.072 361.709 107.884C359.585 109.57 356.932 110.943 353.747 112.005C350.625 113.067 347.627 113.597 344.755 113.597ZM400.258 113.597C395.388 113.597 390.985 112.473 387.051 110.225C383.18 107.915 380.089 104.793 377.778 100.859C375.53 96.9247 374.406 92.4911 374.406 87.558C374.406 82.6249 375.437 78.2225 377.497 74.351C379.62 70.417 382.493 67.326 386.115 65.078C389.736 62.7675 393.826 61.6123 398.385 61.6123C402.069 61.6123 405.472 62.3929 408.595 63.954C411.717 65.4527 414.339 67.5133 416.463 70.136V44.846C416.463 43.4098 416.9 42.2545 417.774 41.3803C418.711 40.5061 419.866 40.069 421.24 40.069C422.676 40.069 423.831 40.5061 424.705 41.3803C425.579 42.2545 426.017 43.4098 426.017 44.846V87.558C426.017 92.4911 424.861 96.9247 422.551 100.859C420.303 104.793 417.243 107.915 413.372 110.225C409.5 112.473 405.129 113.597 400.258 113.597ZM400.258 105.167C403.443 105.167 406.284 104.418 408.782 102.919C411.28 101.358 413.247 99.2351 414.683 96.55C416.119 93.8649 416.837 90.8675 416.837 87.558C416.837 84.186 416.119 81.1887 414.683 78.566C413.247 75.9433 411.28 73.8827 408.782 72.384C406.284 70.8229 403.443 70.0423 400.258 70.0423C397.136 70.0423 394.295 70.8229 391.735 72.384C389.237 73.8827 387.239 75.9433 385.74 78.566C384.304 81.1887 383.586 84.186 383.586 87.558C383.586 90.8675 384.304 93.8649 385.74 96.55C387.239 99.2351 389.237 101.358 391.735 102.919C394.295 104.418 397.136 105.167 400.258 105.167ZM476.137 113.223C474.763 113.223 473.608 112.754 472.671 111.818C471.735 110.881 471.266 109.726 471.266 108.352V44.9397C471.266 43.5034 471.735 42.3482 472.671 41.474C473.608 40.5373 474.763 40.069 476.137 40.069H498.523C502.77 40.069 506.485 40.912 509.67 42.598C512.917 44.2215 515.446 46.5008 517.257 49.4357C519.13 52.3705 520.067 55.7425 520.067 59.5517C520.067 62.6114 519.224 65.3902 517.538 67.888C515.914 70.3233 513.666 72.2591 510.794 73.6953C514.915 74.6944 518.225 76.6614 520.722 79.5963C523.22 82.5312 524.469 86.3715 524.469 91.1173C524.469 95.426 523.439 99.2351 521.378 102.545C519.38 105.854 516.57 108.477 512.948 110.413C509.326 112.286 505.174 113.223 500.49 113.223H476.137ZM481.008 104.231H500.49C503.363 104.231 505.892 103.731 508.077 102.732C510.263 101.733 511.98 100.265 513.229 98.3297C514.478 96.3939 515.102 93.9898 515.102 91.1173C515.102 88.4322 514.478 86.2154 513.229 84.467C511.98 82.7185 510.263 81.4072 508.077 80.533C505.892 79.5963 503.363 79.128 500.49 79.128H481.008V104.231ZM481.008 70.136H498.523C502.083 70.136 504.986 69.2618 507.234 67.5133C509.545 65.7649 510.7 63.111 510.7 59.5517C510.7 55.9923 509.545 53.3697 507.234 51.6837C504.986 49.9352 502.083 49.061 498.523 49.061H481.008V70.136ZM547.198 135.703C546.573 135.703 545.824 135.515 544.95 135.141C542.202 133.892 541.453 131.925 542.702 129.24L571.27 64.7033C572.519 62.0807 574.486 61.3313 577.171 62.4553C579.981 63.6418 580.762 65.6088 579.513 68.3563L550.851 132.799C550.102 134.735 548.884 135.703 547.198 135.703ZM558.251 111.162C557.064 111.662 555.94 111.724 554.879 111.349C553.879 110.912 553.068 110.1 552.443 108.914L530.994 68.169C530.369 66.9825 530.275 65.8585 530.713 64.797C531.212 63.673 532.055 62.8612 533.242 62.3617C534.428 61.8621 535.552 61.8309 536.614 62.268C537.675 62.6427 538.487 63.4232 539.049 64.6097L559.562 105.355C560.186 106.541 560.405 107.696 560.218 108.82C560.093 109.882 559.437 110.662 558.251 111.162Z" fill="url(#paint5_linear_999_36)" />
                      <path ref={ref_Separator}
                          id="separator" d="M702.5 23.6113L702.5 82.4532L702.5 132.889" stroke="#B07951" strokeWidth="3.90278" />
                      <path ref={ref_TagElement1}
                          id="tagElement1" d="M46.8335 54.6387L15.6113 74.1526C27.8044 81.7732 34.6405 86.0458 46.8335 93.6665" stroke="url(#paint6_linear_999_36)" strokeWidth="9.36667" strokeLinecap="round" strokeLinejoin="round" />
                      <path ref={ref_TagElement2}
                          id="tagElement2" d="M636.153 54.6387L667.375 74.1526C655.182 81.7732 648.346 86.0458 636.153 93.6665" stroke="url(#paint7_linear_999_36)" strokeWidth="9.36667" strokeLinecap="round" strokeLinejoin="round" />
                      <path ref={ref_TagElement3}
                          id="tagElement3" d="M593.223 108.594L620.542 38.3438" stroke="url(#paint8_linear_999_36)" strokeWidth="9.36667" strokeLinecap="round" strokeLinejoin="round" />
                  </g>
             <linearGradient id="paint0_linear_999_36" x1="931.422" y1="62.3945" x2="931.422" y2="109.285" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint1_linear_999_36" x1="1000.94" y1="60.0547" x2="1000.94" y2="109.58" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint2_linear_999_36" x1="1071.19" y1="30.7832" x2="1071.19" y2="109.261" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint3_linear_999_36" x1="868.246" y1="60.0547" x2="868.246" y2="109.317" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint4_linear_999_36" x1="780.556" y1="50.931" x2="780.523" y2="115.322" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint5_linear_999_36" x1="229.431" y1="111.223" x2="227.235" y2="20.0968" gradientUnits="userSpaceOnUse">
            <stop stopColor="#7A4F2E" />
            <stop offset="1" stopColor="#E2A874" />
        </linearGradient>
        <linearGradient id="paint6_linear_999_36" x1="31.2224" y1="54.6387" x2="31.2224" y2="93.6665" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint7_linear_999_36" x1="651.764" y1="27.3192" x2="651.764" y2="109.278" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <linearGradient id="paint8_linear_999_36" x1="606.882" y1="38.3437" x2="606.882" y2="108.594" gradientUnits="userSpaceOnUse">
            <stop stopColor="#C2875D" />
            <stop offset="1" stopColor="#7A4F2E" />
        </linearGradient>
        <clipPath id="clip0_999_36">
            <rect width="1124" height="140.5" fill="white" />
        </clipPath>
        <clipPath id="clip1_999_36">
            <rect width="70.25" height="132.694" fill="white" transform="translate(968.5 -18)" />
        </clipPath>
        <clipPath id="clip2_999_36">
            <rect width="93.6667" height="93.6667" fill="white" transform="translate(733.722 23.6113)" />
        </clipPath>
        </svg>
      </div>
    </div>
  );
};

export default Logo;
